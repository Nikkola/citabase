define(["jquery","lodash","backbone","events","app","sessionModel","text!../../../templates/auth_header.phtml","text!../../../templates/no_auth_header.phtml"],function(e,t,n,r,i,s,o,u){i.Views.LoginView=n.View.extend({el:".wrapper",initialize:function(){},render:function(){e("header").html(u),this.validate()},renderAuth:function(){e("header").html(o)},events:{"click .login-send":"login","click .logout-btn":"logout","keyup #login-name, #login-password":"checkBtnActive","click .close":"closeAlert"},checkBtnActive:function(){var t=e(".login-send");e(".login-form").valid()?t.removeClass("disabled").removeAttr("disabled"):t.addClass("disabled").attr("disabled","disabled")},closeAlert:function(t){t.preventDefault();var n=e(".login-alert");n.addClass("h")},login:function(t){var n=e("#login-name"),r=e("#login-password"),i=e(".login-alert"),o=this;t.preventDefault();if(n.val()!==""&&r.val()!==""){var u=e(".login-form").serializeArray();e.ajax({type:"POST",url:"/login",data:u,dataType:"json",success:function(t){i.addClass("h"),t.msg==="User is logged in"?(s.save({id:t.id,access_token:t.access_token,username:t.username}),s.initialize(),s.auth()&&(o.renderAuth(),e(".profile-name").text(s.get("username")),location.reload())):(console.log("не прошел логин!"),i.removeClass("h"),i.alert())}})}},validate:function(){e(".login-form").validate({rules:{username:{minlength:2,required:!0},password:{minlength:8,required:!0}},messages:{username:"!",password:{required:"!",minlength:"!"}},highlight:function(t){e(t).closest(".control-group").removeClass("success").addClass("error")},success:function(e){e.addClass("control-label").addClass("valid").closest(".control-group").removeClass("error").addClass("success")}})},logout:function(t){var n=this;t.preventDefault(),e.ajax({type:"POST",url:"/logout",dataType:"json",success:function(e){e&&(s.kill(),s.auth()||(n.render(),location.reload()))}})}});var a=new i.Views.LoginView;return a});