/*
* File:        jquery.dataTables.columnFilter.js
* Version:     0.9.0
* Author:      Jovan Popovic 
* 
* Copyright 2011 Jovan Popovic, all rights reserved.
*
* This source file is free software, under either the GPL v2 license or a
* BSD style license, as supplied with this software.
* 
* This source file is distributed in the hope that it will be useful, but 
* WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
* or FITNESS FOR A PARTICULAR PURPOSE. 
* 
* Parameters:
* @sPlaceHolder                 String      Place where inline filtering function should be place ("tfoot", "thead"). Default is "tfoot"
* @sRangeSeparator              String      Separatot that will be used when range values are sent to the server-side. Default value is "~".
* @iFilteringDelay              int         TODO: Delay that will be set between the filtering requests. Default is 250.
* @sRangeFormat                 string      Default format of the From ... to ... range inputs. Default is From {from} to {to}
* @aoColumns                    Array       Array of the filter settings that will be applied on the columns

http://www.datatables.net/plug-ins/filtering

*/

(function(e){function l(s,o,u){var a="text_filter";u&&(a="number_filter");var f=e('<input type="text" class="search_init '+a+'" value="'+r+'"/>');i.html(f),u?i.wrapInner('<span class="filter_column filter_number" />'):i.wrapInner('<span class="filter_column filter_text" />'),t[n]=r;var l=n;u&&!oTable.fnSettings().oFeatures.bServerSide?f.keyup(function(){oTable.fnFilter("^"+this.value,l,!0,!1)}):f.keyup(function(){oTable.fnFilter(this.value,l,s,o)}),f.focus(function(){e(this).hasClass("search_init")&&(e(this).removeClass("search_init"),this.value="")}),f.blur(function(){this.value==""&&(e(this).addClass("search_init"),this.value=t[l])})}function c(){i.html(d(0));var t=s+"range_from_"+n,r=e('<input type="text" class="number_range_filter" id="'+t+'" rel="'+n+'"/>');i.append(r),i.append(d(1));var o=s+"range_to_"+n,u=e('<input type="text" class="number_range_filter" id="'+o+'" rel="'+n+'"/>');i.append(u),i.append(d(2)),i.wrapInner('<span class="filterColumn filter_number_range" />');var f=n;a.push(n),e.fn.dataTableExt.afnFiltering.push(function(e,n,r){var i=document.getElementById(t).value*1,s=document.getElementById(o).value*1,u=n[f]=="-"?0:n[f]*1;return i==""&&s==""?!0:i==""&&u<s?!0:i<u&&""==s?!0:i<u&&u<s?!0:!1}),e("#"+t+",#"+o,i).keyup(function(){var e=document.getElementById(t).value*1,n=document.getElementById(o).value*1;if(e!=0&&n!=0&&e>n)return;oTable.fnDraw()})}function h(){i.html(d(0));var t=s+"range_from_"+n,r=e('<input type="text" class="date_range_filter" id="'+t+'" rel="'+n+'"/>');r.datepicker(),i.append(r),i.append(d(1));var o=s+"range_to_"+n,u=e('<input type="text" class="date_range_filter" id="'+o+'" rel="'+n+'"/>');i.append(u),i.append(d(2)),i.wrapInner('<span class="filterColumn filter_date_range" />'),u.datepicker();var f=n;a.push(n),e.fn.dataTableExt.afnFiltering.push(function(t,n,i){var s=r.datepicker("getDate"),o=u.datepicker("getDate"),a=e.datepicker.parseDate(e.datepicker.regional[""].dateFormat,n[f]);return a==null?!1:s==null&&o==null?!0:s==null&&a<o?!0:s<a&&o==null?!0:s<a&&a<o?!0:!1}),e("#"+t+",#"+o,i).change(function(){oTable.fnDraw()})}function p(t){var s=n,o='<select class="search_init select_filter"><option value="" class="search_init">'+r+"</option>",u,a=t.length;for(u=0;u<a;u++)o+='<option value="'+t[u]+'">'+t[u]+"</option>";var f=e(o+"</select>");i.html(f),i.wrapInner('<span class="filterColumn filter_select" />'),f.change(function(){e(this).val()!=""?e(this).removeClass("search_init"):e(this).addClass("search_init"),oTable.fnFilter(e(this).val(),s)})}function d(e){switch(e){case 0:return o.substring(0,o.indexOf("{from}"));case 1:return o.substring(o.indexOf("{from}")+6,o.indexOf("{to}"));default:return o.substring(o.indexOf("{to}")+4)}}var t,n,r,i,s="table",o="From {from} to {to}",u=new Array,a=new Array,f=null;e.fn.columnFilter=function(s){oTable=this;var f={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}"};return properties=e.extend(f,s),this.each(function(){t=new Array;var s="tfoot tr";if(properties.sPlaceHolder=="head:after")s="thead tr:last";else if(properties.sPlaceHolder=="head:before"){var f=e("thead tr:last").detach();f.prependTo("thead"),s="thead tr:first"}e(s+" th",oTable).each(function(t){n=t;var s={type:"text",bRegex:!1,bSmart:!0};if(properties.aoColumns!=null){if(properties.aoColumns.length<n||properties.aoColumns[n]==null)return;s=properties.aoColumns[n]}r=e(this).text(),i=e(e(this)[0]);if(s!=null){s.sRangeFormat!=null?o=s.sRangeFormat:o=properties.sRangeFormat;switch(s.type){case"number":l(!0,!1,!0);break;case"text":bRegex=s.bRegex==null?!1:s.bRegex,bSmart=s.bSmart==null?!1:s.bSmart,l(bRegex,bSmart,!1);break;case"select":p(s.values);break;case"number-range":c();break;case"date-range":h();break;default:}}});for(j=0;j<a.length;j++){var d=a[j],v=function(){return e("#range_from_"+d).val()+properties.sRangeSeparator+e("#range_to_"+d).val()};u.push(v)}if(oTable.fnSettings().oFeatures.bServerSide){var m=oTable.fnSettings().fnServerData;oTable.fnSettings().fnServerData=function(t,n,r){for(j=0;j<a.length;j++){var i=a[j];for(k=0;k<n.length;k++)n[k].name=="sSearch_"+i&&(n[k].value=u[j]())}n.push({name:"sRangeSeparator",value:properties.sRangeSeparator}),m!=null?m(t,n,r):e.getJSON(t,n,function(e){r(e)})}}})}})(jQuery);